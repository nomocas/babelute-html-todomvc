(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t():typeof define==="function"&&define.amd?define(t):t()})(this,function(){"use strict";var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,n,i){if(n)e(t.prototype,n);if(i)e(t,i);return t}}();function t(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n={emitDelay:10,strictMode:false};var i=function(){function i(){var e=arguments.length<=0||arguments[0]===undefined?n:arguments[0];t(this,i);var r=void 0,o=void 0;if(e.hasOwnProperty("emitDelay")){r=e.emitDelay}else{r=n.emitDelay}this._emitDelay=r;if(e.hasOwnProperty("strictMode")){o=e.strictMode}else{o=n.strictMode}this._strictMode=o;this._listeners={};this.events=[]}e(i,[{key:"_addListenner",value:function e(t,n,i){if(typeof n!=="function"){throw TypeError("listener must be a function")}if(this.events.indexOf(t)===-1){this._listeners[t]=[{once:i,fn:n}];this.events.push(t)}else{this._listeners[t].push({once:i,fn:n})}}},{key:"on",value:function e(t,n){this._addListenner(t,n,false)}},{key:"once",value:function e(t,n){this._addListenner(t,n,true)}},{key:"off",value:function e(t,n){var i=this;var r=this.events.indexOf(t);var o=t&&r!==-1;if(o){if(!n){delete this._listeners[t];this.events.splice(r,1)}else{(function(){var e=[];var o=i._listeners[t];o.forEach(function(t,i){if(t.fn===n){e.unshift(i)}});e.forEach(function(e){o.splice(e,1)});if(!o.length){i.events.splice(r,1);delete i._listeners[t]}})()}}}},{key:"_applyEvents",value:function e(t,n){var i=this._listeners[t];if(!i||!i.length){if(this._strictMode){throw"No listeners specified for event: "+t}else{return}}var r=[];i.forEach(function(e,t){e.fn.apply(null,n);if(e.once){r.unshift(t)}});r.forEach(function(e){i.splice(e,1)})}},{key:"emit",value:function e(t){var n=this;for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++){r[o-1]=arguments[o]}if(this._emitDelay){setTimeout(function(){n._applyEvents.call(n,t,r)},this._emitDelay)}else{this._applyEvents(t,r)}}},{key:"emitSync",value:function e(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++){i[r-1]=arguments[r]}this._applyEvents(t,i)}},{key:"destroy",value:function e(){this._listeners={};this.events=[]}}]);return i}();var r=i;var o=new r;var s={todos:[],route:"all",ID:0,methods:{append:function e(t){this.todos=this.todos.concat({title:t||"",id:this.ID++,completed:false});this.emit("update",this)},prepend:function e(t){this.todos=[{title:t||"",id:this.ID++,completed:false}].concat(this.todos);this.emit("update",this)},delete:function e(t){this.todos=this.todos.filter(function(e){return e.id!==t});this.emit("update",this)},toggleComplete:function e(t){this.todos=this.todos.map(function(e){if(e.id===t){e=Object.assign({},e);e.completed=!e.completed}return e});this.emit("update",this)},updateTitle:function e(t,n){this.todos=this.todos.map(function(e){if(e.id===t&&e.title!==n){e=Object.assign({},e);e.title=n}return e});this.emit("update",this)},clearCompleted:function e(){this.todos=this.todos.filter(function(e){return!e.completed});this.emit("update",this)},toggleAll:function e(){this.todos=this.todos.map(function(e){e=Object.assign({},e);e.completed=!e.completed;return e});this.emit("update",this)}}};for(var a in s){o[a]=s[a]}for(var l in o.methods){o.methods[l]=o.methods[l].bind(o)}var c=function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}};var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}return function(t,n,i){if(n)e(t.prototype,n);if(i)e(t,i);return t}}();var f=function(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t};var d=function(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e};var h=function e(t,n,i){c(this,e);this.lexicon=t;this.name=n;this.args=i};var p=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;c(this,e);this._lexems=t||[];this.__babelute__=true}u(e,[{key:"_append",value:function e(t,n,i){this._lexems.push(new h(t,n,i));return this}},{key:"_if",value:function e(t,n){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(t)this._lexems=this._lexems.concat(n._lexems);else if(i)this._lexems=this._lexems.concat(i._lexems);return this}},{key:"_each",value:function e(t,n){var i=this;t.forEach(function(e,t){var r=n(e,t);i._lexems.push.apply(i._lexems,r._lexems)});return this}},{key:"_use",value:function e(t){}},{key:"_lexicon",value:function e(t){}}],[{key:"extends",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=function e(n){t.call(this,n)};i.prototype=Object.create(t.prototype);i.prototype.constructor=i;for(var r in n){i.prototype[r]=n[r]}return i}}]);return e}();function v(e){return JSON.parse(e,function(e,t){if(t&&t.__babelute__)return new p(t._lexems.map(function(e){return new h(e.lexicon,e.name,e.args)}));return t})}var m=function(e){f(t,e);function t(e){c(this,t);var n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.__first_level_babelute__=true;return n}u(t,null,[{key:"getFirstLevelMethod",value:function e(t,n){return function(){this._lexems.push(new h(t,n,arguments));return this}}}]);return t}(p);var g={};function y(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new _(e,t)}var _=function(){function e(t){var n=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;c(this,e);this.parent=i;this.name=t;i=i||{};this.Atomic=x(i.Atomic||p);this.FirstLevel=x(i.FirstLevel||m);this.SecondLevel=p.extends(i.SecondLevel||p);this.secondLevel=new this.SecondLevel;if(i.Atomic)Object.keys(i.Atomic.initializer).forEach(function(e){k(n.Atomic.Initializer,e);k(n.FirstLevel.Initializer,e)})}u(e,[{key:"addAtoms",value:function e(t){var n=this;t.forEach(function(e){return b(n,e)});return this}},{key:"addCompounds",value:function e(t){var n=this;var i=t(this.Atomic.initializer);for(var r in i){this.Atomic.prototype[r]=i[r]}var o=t(this.FirstLevel.initializer);for(var s in o){this.SecondLevel.prototype[s]=o[s]}Object.keys(i).forEach(function(e){n.FirstLevel.prototype[e]=m.getFirstLevelMethod(n.name,e);k(n.Atomic.Initializer,e);k(n.FirstLevel.Initializer,e)});return this}},{key:"addShortcut",value:function e(t,n){this.Atomic.prototype[t]=this.FirstLevel.prototype[t]=this.SecondLevel.prototype[t]=n;return this}},{key:"useAtomic",value:function e(t,n,i){if(!this.Atomic.instance[n])throw new Error("Babelute ("+this.name+") : method not found : "+n);this.Atomic.instance[n].apply(t,i)}},{key:"useFirstLevel",value:function e(t,n,i){if(!this.FirstLevel.instance[n])throw new Error("Babelute ("+this.name+") : method not found : "+n);this.FirstLevel.instance[n].apply(t,i)}},{key:"translateToAtomic",value:function e(t,n){return O(t,this.Atomic,n||this.targets)}},{key:"translateToFirstLevel",value:function e(t,n){return O(t,this.FirstLevel,n||this.targets)}},{key:"initializer",value:function e(t){return t?this.FirstLevel.initializer:this.Atomic.initializer}}]);return e}();function b(e,t){e.Atomic.prototype[t]=e.FirstLevel.prototype[t]=e.SecondLevel.prototype[t]=m.getFirstLevelMethod(e.name,t);k(e.Atomic.Initializer,t);k(e.FirstLevel.Initializer,t)}function x(e){var t=p.extends(e);L(t,e.Initializer);t.instance=new t;return t}var w=function(){function e(){c(this,e)}u(e,null,[{key:"extends",value:function e(t){var n=function e(){};n.prototype=Object.create(t.prototype);n.prototype.constructor=n;return n}}]);return e}();function L(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=e.Initializer=t?w.extends(t):w;e.initializer=new n;e.initializer._empty=function(){return new e};e.initializer.BabeluteClass=e;Object.keys(e).forEach(function(e){k(n,e)});return e.initializer}function k(e,t){e.prototype[t]=function(){return this.BabeluteClass.prototype[t].apply(new this.BabeluteClass,arguments)}}function A(e){var t=g[e];if(!t)throw new Error("lexicon not found : "+e);return t}function E(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;g[t||e.name]=e}function C(e,t){if(!t)return A(e).Atomic.initializer;return A(e).FirstLevel.initializer}p.prototype._lexicon=function(e){return new(A(e).Atomic)(this._lexems)};m.prototype._lexicon=function(e){return new(A(e).FirstLevel)(this._lexems)};p.prototype._use=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++){n[i-1]=arguments[i]}return e?F(this,e,n,false):this};m.prototype._use=function(e){return e?F(this,e,[].slice.call(arguments,1),true):this};function F(e,t,n,i){if(typeof t==="string"){var r=t.split(":"),o=r.lexiconName,s=r.methodName;A(o)[i?"useFirstLevel":"useAtomic"](e,s,n)}else if(t.__babelute__)e._lexems=e._lexems.concat(t._lexems);return e}function O(e,t,n){var i=new t;e._lexems.forEach(function(e){if(n&&!n[e.lexicon]||this[e.name])this._lexems.push(new h(e.lexicon,e.name,e.args));else this[e.name].apply(this,e.args.map(function(e){if(!e||!e.__babelute__)return e;return O(e,t,n)}))},i);return i}function S(e,t){if(e)return new(A(e)[t?"FirstLevel":"Atomic"]);else if(t)return new m;return new p}function z(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;t=t||A(e.lexicon);return t.secondLevel[e.name].apply(new t.FirstLevel,e.args)}var j=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};c(this,e);this._targets=t;if(n)this.addPragmas(n)}u(e,[{key:"addPragmas",value:function e(t){for(var n in t){this[n]=t[n]}}},{key:"$output",value:function e(){}}]);return e}();function I(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new j(e,t)}var T=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};c(this,e);this.scope=t}u(e,[{key:"push",value:function e(t,n){this.scope[t]=this.scope[t]||[];return this.scope[t].push(n)}},{key:"pop",value:function e(t){if(!this.scope[t].length)return;return this.scope[t].pop()}},{key:"get",value:function e(t){var n=this.scope[t];if(!n)throw new Error("scope not found with : "+t);return n[n.length-1]}}]);return e}();var D=function(e){f(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;c(this,t);return d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}u(t,[{key:"each",value:function e(t,n,i){var r=n[0],o=n[1];if(r.length)for(var s=0,a=r.length,l,c;s<a;++s){l=r[s];c=o(l,s);if(c)this.$output(t,c,i)}}},{key:"if",value:function e(t,n,i){if(n[0])this.$output(t,n[1],i);else if(n[2])this.$output(t,n[2],i)}},{key:"$output",value:function e(t,n){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;for(var r=0,o,s=n._lexems.length;r<s;++r){o=n._lexems[r];if(this._targets[o.lexicon]&&this[o.name])this[o.name](t,o.args,i)}return t}}]);return t}(j);function P(e,t){var n=function t(n,i){e.Atomic.call(this);this._subject=n;this._scopes=i};n.prototype=Object.create(e.Atomic.prototype);n.prototype.constructor=n;n.prototype._lexicon=null;n.prototype._append=function(e,n,i){if((!t._targets||t._targets[e])&&t[n])t[n](this._subject,i,this._scopes);return this};return function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new n(e,t||new T)}}function B(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new D(e,t)}var M={createLexicon:y,createPragmatics:I,createFacadeInitializer:P,createFacadePragmatics:B,init:S,initializer:C,getLexicon:A,registerLexicon:E,developOneLevel:z,fromJSON:v,Babelute:p,Lexem:h,Pragmatics:j,FacadePragmatics:D,Scopes:T};function N(e,t,n){if(!e)return;var i=document.createElement("div"),r=[];var o=void 0;if(e[0]!=="<"){e="<p>"+e+"</p>";o=true}i.innerHTML=e;var s=o?i.firstChild:i,a=[].slice.call(s.childNodes);var l=void 0;if(n)l=document.createDocumentFragment();for(var c=0,u=a.length,f;c<u;++c){f=a[c];r.push(f);(l||t).appendChild(f)}if(n)t.insertBefore(l,n);return r}function $(e,t){switch(t){case"text":return e.textContent;case"integer":return parseInt(e.textContent,10);case"html":return e.innerHTML;default:throw new Error("content editable casting fail : unrecognised rule : ",t)}}var H=y("html");H.atomsList=["tag","attr","prop","data","class","id","style","text","on","onDom","onString","if","each","keyedEach","html","execute"];H.addAtoms(H.atomsList);H.tagsList=["body","div","h1","h2","h3","h4","h5","section","span","button","main","article","hr","header","footer","label","ul","li","p","small","b","strong","i","u","select","title","meta","table","tr","td","tbody"];H.eventsList=["click","blur","focus","submit","mouseover","mousedown","mouseup","mouseout","touchstart","touchend","touchcancel","touchleave","touchmove","drop","dragover","dragstart"];H.addShortcut("component",function(e,t){return this._append("html","component",[e,t,this.__first_level_babelute__])}).addShortcut("execute",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++){n[i-1]=arguments[i]}return this._append("html","execute",[e,n])}).addCompounds(function(){var e={};H.tagsList.forEach(function(t){e[t]=function(){return this._append("html","tag",[t,arguments])}});H.eventsList.forEach(function(t){e[t]=function(e,n){return this._append("html","on",[t,e,n])}});return e}).addCompounds(function(e){return{link:function t(n,i,r){return this.tag("link",[e.attr("href",n).attr("rel",i),r])},linkCSS:function t(n){return this.link(n,"stylesheet",e.attr("type","text/css"))},input:function t(n,i,r){return this.tag("input",[e.attr("type",n).attr("value",i),r])},textInput:function e(t,n){return this.input("text",t,n)},passwordInput:function e(t,n){return this.input("password",t,n)},checkbox:function t(n,i){return this.tag("input",[e.attr("type","checkbox").prop("checked",!!n),i])},radio:function t(n,i){return this.tag("input",[e.attr("type","radio").prop("checked",!!n),i])},option:function t(n,i,r){return this.tag("option",[e.attr("value",n).prop("selected",!!r),i])},script:function t(n,i){return this.tag("script",[e.attr("src",n).attr("type","text/javascript"),i])},a:function t(){arguments[0]=e.attr("href",arguments[0]);return this.tag("a",arguments)},img:function t(){arguments[0]=e.attr("src",arguments[0]);return this.tag("img",arguments)},nbsp:function e(){return this.text(" ")},visible:function e(t){return this.style("visibility",t?"visible":"hidden")},display:function e(t){return this.style("display",typeof t==="string"?t:t?"block":"none")},contentEditable:function e(t){return this.prop("contentEditable",t.isEditable!==false).prop(t.valueType==="html"?"innerHTML":"textContent",t.value||"").on(t.updateOnEvent||"blur",function(e){t.updateHandler($(e.currentTarget,t.valueType||"text"))}).click(function(e){if(t.isEditable!==false){e.preventDefault();e.stopPropagation()}})}}});H.tagsList.forEach(function(e){H.FirstLevel.prototype[e]=function(){return this._append("html","tag",[e,arguments])}});var J=M.createLexicon("todomvc",H);J.addCompounds(function(e){return{todomvc:function t(n,i,r){var o=i!=="all"?n.filter(function(e){return i==="completed"?e.completed:!e.completed}):n;return this.div(e.class("todomvc-wrapper").section(e.id("todoapp").class("todoapp").todomvcHeader(r).section(e.id("main").class("main").visible(n.length).toggleAllButton(r).ul(e.id("todo-list").class("todo-list").each(o,function(t){return e.todoItem(t,r)}))).statsSection(n,i,r)).todomvcFooter())},todomvcHeader:function t(n){return this.header(e.id("header").class("header").h1("Todos").textInput("",e.id("new-todo").class("new-todo").attr("placeholder","What needs to be done?").on("keydown",function(e){if(e.keyCode===13&&e.target.value){n.append(e.target.value);e.target.value=""}})))},toggleAllButton:function t(n){return this.checkbox(false,e.id("toggle-all").class("toggle-all").attr("name","toggle").on("click",n.toggleAll)).label(e.attr("for","toggle-all"),"Mark all as complete")},todoLabel:function t(n,i,r){return this.label(i,e.prop("contentEditable",true).on("keyup",function(e){if(e.keyCode===27)n.updateTitle(r,i);else n.updateTitle(r,e.target.textContent)}))},todoItem:function t(n,i){return this.li(e.class("completed",n.completed).div(e.class("view").checkbox(n.completed,e.class("toggle").on("click",function(){return i.toggleComplete(n.id)})).todoLabel(i,n.title,n.id).button(e.class("destroy").on("click",function(){return i.delete(n.id)}))))},todomvcFooter:function t(){return this.footer(e.id("info").class("info").p("Written by ",e.a("https://github.com/nomocas","nomocas")).p("Part of ",e.a("http://todomvc.com","TodoMVC")))},statsSectionNav:function t(n){return this.ul(e.id("filters").class("filters").li(e.a("#/",e.class("selected",n==="all"),"All")).li(e.a("#/active",e.class("selected",n==="active"),"Active")).li(e.a("#/completed",e.class("selected",n==="completed"),"Completed")))},clearCompletedButton:function t(n,i){return this.button(e.id("clear-completed").class("clear-completed").visible(n>0).on("dblclick",i.clearCompleted),"Clear completed ("+n+")")},statsSection:function t(n,i,r){var o=n.filter(function(e){return!e.completed}).length,s=n.length-o;return this.footer(e.id("footer").class("footer").visible(n.length).span(e.id("todo-count").class("todo-count").strong(o),(o===1?" item":" items")+" left").statsSectionNav(i).clearCompletedButton(s,r))}}});var V=M.Scopes;var W=H.Atomic.initializer;var q={html:true};var R={class:function e(t,n){var i=n.args;if(i[0]&&(i.length===1||i[1]))t.classList.add(i[0])},attr:function e(t,n){var i=n.args;t.setAttribute(i[0],i[1])},prop:function e(t,n){var i=n.args;t[i[0]]=i[1]},data:function e(t,n){var i=n.args;t.dataset[i[0]]=i[1]},style:function e(t,n){var i=n.args;t.style[i[0]]=i[1]},id:function e(t,n){t.id=n.args[0]},on:function e(t,n){var i=n.args;var r=n.closure={handler:i[1],arg:i[2]};n.listener=function(e){return r.handler.call(this,e,r.arg)};t.addEventListener(i[0],n.listener)},tag:function e(t,n,i,r){n.child=document.createElement(n.args[0]);(r||t).appendChild(n.child);var o=n.args[1];for(var s=0,a=o.length,l;s<a;++s){l=o[s];if(typeof l==="undefined")l="";if(!l||!l.__babelute__)l=o[s]=W.text(l);G(n.child,l,i)}},text:function e(t,n,i,r){n.child=document.createTextNode(n.args[0]);(r||t).appendChild(n.child)},if:function e(t,n,i,r){var o=n.args[0]?n.args[1]:n.args[2]?n.args[2]:null;if(o){n.developed=typeof o==="function"?o():o;G(t,n.developed,i,r)}n.witness=document.createComment("if");t.appendChild(n.witness)},each:function e(t,n,i,r){var o=n.args;n.children=[];var s=o[0]=o[0]||[],a=o[1];for(var l=0,c=s.length,u;l<c;++l){u=a(s[l]);n.children.push(u);G(t,u,i,r)}n.witness=document.createComment("each");t.appendChild(n.witness)},onDom:function e(t,n,i,r){var o=n.args[0];if(o)o(t,n,i,r)},html:function e(t,n){n.children=N(n.args[0],t)},execute:function e(t,n){n.args[0].apply(null,n.args[1])}};function G(e,t,n,i){for(var r=0,o,s,a=t._lexems,l=a.length;r<l;++r){s=a[r];if(!q[s.lexicon])continue;o=R[s.name];if(o)o(e,s,n,i);else{s.developed=M.developOneLevel(s,q[s.lexicon]);G(e,s.developed,n,i)}}}var K={if:function e(t,n,i,r){n.witness=i.witness;var o=n.args,s=i.args;var a=void 0;if(!o[0]!==!s[0]){if(!o[0]||s[2])Y(t,i.developed,r);a=o[0]?o[1]:o[2];if(a){var l=document.createDocumentFragment();n.developed=typeof a==="function"?a():a;G(t,n.developed,r,l);t.insertBefore(l,n.witness)}}else{a=o[0]?o[1]:o[2];if(a){n.developed=typeof a==="function"?a():a;Q(t,n.developed,i.developed,r)}}},each:function e(t,n,i,r){var o=n.args[0],s=n.args[1],a=i.children,l=o.length,c=a.length,u=n.children=new Array(l);var f=void 0,d=void 0,h=void 0,p=0;n.witness=i.witness;if(l>c)d=document.createDocumentFragment();for(;p<l;++p){h=o[p];f=s(h);u[p]=f;if(p<c)Q(t,f,a[p],r);else G(t,f,r,d)}for(;p<c;++p){Y(t,a[p],r)}if(d)t.insertBefore(d,n.witness)},tag:function e(t,n,i,r){n.child=i.child;var o=n.args[1],s=i.args[1];var a=void 0,l=void 0;for(var c=0,u=o.length;c<u;c++){a=o[c];l=s[c];if(a===l)continue;if(typeof a==="undefined")a="";if(!a||!a.__babelute__)a=o[c]=W.text(a);Q(n.child,a,l,r)}},text:function e(t,n,i){var r=n.args[0];n.child=i.child;if(r!==i.args[0])n.child.nodeValue=r},class:function e(t,n,i){var r=n.args[0],o=i.args[0],s=n.args[1],a=i.args[1];if(r!==o){if(o)t.classList.remove(o);if(r&&(n.args.length===1||s))t.classList.add(r)}else if(r&&n.args.length>1&&!s!==!a)t.classList.toggle(r)},attr:function e(t,n,i){var r=n.args[0],o=n.args[1],s=i.args[0],a=i.args[1];if(r!==s){t.removeAttribute(s);t.setAttribute(r,o)}else if(o!==a)t.setAttribute(r,o)},prop:function e(t,n,i){var r=n.args[0],o=n.args[1],s=i.args[0];if(r!==s){delete t[s];t[r]=o}else if(o!==t[r])t[r]=o},data:function e(t,n,i){var r=n.args[0],o=n.args[1],s=i.args[0],a=i.args[1];if(r!==s){delete t.dataset[s];t.dataset[r]=o}else if(o!==a)t.dataset[r]=o},style:function e(t,n,i){var r=n.args[0],o=n.args[1],s=i.args[0],a=i.args[1];if(r!==s){delete t.style[s];t.style[r]=o}else if(o!==a)t.style[r]=o},id:function e(t,n,i){var e=n.args[0];if(e!==i.args[0])t.id=e},on:function e(t,n,i){var r=n.args[0],o=i.args[0];if(r!==o){t.removeEventListener(o,i.listener);R.on(t,n)}else{var s=n.closure=i.closure;n.listener=i.listener;s.handler=n.args[1];s.arg=n.args[2]}},onDom:function e(t,n,i){var r=n.args[1];if(r)r(t,n,i)},html:function e(t,n,i){var r=n.args[0];if(i.args[0]!==r){var o=i.children?i.children[i.children.length-1]:null,s=o?o.nextSibling:null;i.children&&i.children.forEach(function(e){return t.removeChild(e)});n.children=N(r,t,s)}},execute:function e(t,n,i){if(n.args[0]!==i.args[0]||!U(n.args[1],i.args[1]))return;n.args[0].apply(null,n.args[1])}};function Q(e,t,n,i){for(var r,o,s,a=0,l=t._lexems.length;a<l;++a){r=t._lexems[a];if(!q[r.lexicon])continue;o=n._lexems[a];if(!r.args.length)r.developed=o.developed;else{s=K[r.name];if(s)s(e,r,o,i);else if(U(r.args,o.args)){r.developed=M.developOneLevel(r,q[r.lexicon]);Q(e,r.developed,o.developed,i)}else r.developed=o.developed}}}function U(e,t){for(var n=0,i=e.length;n<i;++n){if(e[n]!==t[n])return true}return false}var X={attr:function e(t,n){t.removeAttribute(n.args[0])},class:function e(t,n){if(n.args[0])t.classList.remove(n.args[0])},prop:function e(t,n){delete t[n.args[0]]},data:function e(t,n){delete t.dataset[n.args[0]]},style:function e(t,n){delete t.style[n.args[0]]},id:function e(t){delete t.id},on:function e(t,n){t.removeEventListener(n.args[0],n.listener)},each:function e(t,n,i){n.children.forEach(function(e){return Y(t,e,i)})},onDom:function e(t,n){var i=n.args[2];if(i)i(t,n)},html:function e(t,n){if(n.children)n.children.forEach(function(e){return t.removeChild(e)})}};function Y(e,t,n){for(var i=0,r=t._lexems,o,s,a=r.length;i<a;++i){o=r[i];if(!q[o.lexicon])continue;s=X[o.name];if(s)s(e,o,n);else if(o.developed){Y(e,o.developed,n);o.developed=null}else if(o.child){e.removeChild(o.child);o.child=null}if(o.witness)e.removeChild(o.witness)}}var Z=M.createPragmatics(q,{$output:function e(t,n,i,r){r=r||new V(this._initScopes?this._initScopes():null);i?Q(t,n,i,r):G(t,n,r);return n},addLexicon:function e(t,n){this._targets[n||t.name]=t;while(t.parent){t=t.parent;this._targets[t.name]=t}},render:G,dif:Q,remove:Y,renderActions:R,difActions:K,removeActions:X});var ee=J.initializer(true);var te=document.getElementById("todoapp");Z.addLexicon(J);var ne=void 0;var ie=void 0;o.on("update",function(e){if(ie)cancelAnimationFrame(ie);ie=requestAnimationFrame(function(){ne=Z.$output(te,ee.todomvc(e.todos,e.route,e.methods),ne)})});function re(){o.route=window.location.hash.substring(2)||"all";o.emit("update",o)}window.onhashchange=re;re()});